<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é«˜çŸ¥ é˜²ç½è¡Œå‹•ãƒŠãƒ“</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; font-family:sans-serif; }
#map { height:100vh; }
.panel {
  position: fixed;
  top: 10px;
  left: 10px;
  background: white;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index: 1000;
}
button {
  width: 100%;
  margin-top: 5px;
  padding: 8px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="panel">
  <b>é«˜çŸ¥ é˜²ç½è¡Œå‹•ãƒŠãƒ“</b><br>
  <button onclick="getLocation()">ğŸ“ ç¾åœ¨åœ°</button>
  <button onclick="showShelters()">ğŸ« é¿é›£æ‰€è¡¨ç¤º</button>
  <button onclick="routeToShelter()">â¡ æœ€å¯„ã‚Šé¿é›£æ‰€ã¸</button>
</div>

<div id="map"></div>

<script>
var map = L.map('map').setView([33.5597,133.5311],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

var userMarker;
var shelterMarkers=[];
var routeLine;

// ğŸ”¥ é¿é›£æ‰€ãƒ•ãƒ«ãƒªã‚¹ãƒˆ
var shelters=[
{name:"ç¬¬å››å°å­¦æ ¡",lat:33.5583463,lng:133.5244659},
{name:"é«˜çŸ¥å¸‚å½¹æ‰€æœ¬åºèˆ",lat:33.5590,lng:133.5312},
{name:"ã‹ã‚‹ã½ãƒ¼ã¨",lat:33.5587,lng:133.5319},
{name:"æ˜­å’Œå°å­¦æ ¡",lat:33.5588,lng:133.5268},
{name:"æ„›å®•ä¸­å­¦æ ¡",lat:33.5527,lng:133.5218},
{name:"æ±Ÿãƒå£å°å­¦æ ¡",lat:33.5612,lng:133.5227},
{name:"åŸè¥¿ä¸­å­¦æ ¡",lat:33.5701,lng:133.5321},
{name:"æ—­æ±å°å­¦æ ¡",lat:33.5708,lng:133.5328},
{name:"æ½®æ±Ÿæ±å°å­¦æ ¡",lat:33.5440,lng:133.5265},
{name:"çµ¦åˆä½“è‚²é¤¨",lat:33.5702,lng:133.5310},
{name:"ä¸‰é‡Œå°å­¦æ ¡",lat:33.5839,lng:133.5190},
{name:"äº”å°å±±ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.6105,lng:133.5381},
{name:"æ±éƒ¨å¥åº·ç¦ç¥‰ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5843,lng:133.5419},
{name:"å¸ƒç”°ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.6007,lng:133.5313},
{name:"ä¹…é‡å°å­¦æ ¡",lat:33.5832,lng:133.5158},
{name:"ç§¦å°å­¦æ ¡",lat:33.5614,lng:133.5472},
{name:"åˆæœˆãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.6001,lng:133.5703},
{name:"æœå€‰ä¸­å­¦æ ¡",lat:33.5650,lng:133.5407},
{name:"è¥¿éƒ¨å¥åº·ç¦ç¥‰ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5835,lng:133.5055},
{name:"é•·æµœãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5609,lng:133.5890},
{name:"å¾¡ç•³ç€¬ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5613,lng:133.6332},
{name:"æµ¦æˆ¸ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5556,lng:133.6502},
{name:"é«˜çŸ¥çœŒæ•™è‚²ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5519,lng:133.5264},
{name:"ä»‹è‰¯ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5068,lng:133.5869},
{name:"é¡å°å­¦æ ¡",lat:33.5542,lng:133.6321},
{name:"åœŸä½å±±å­¦èˆ",lat:33.4989,lng:133.6563},
{name:"æ˜¥é‡å…¬æ°‘é¤¨å¼˜å²¡ä¸Šåˆ†é¤¨",lat:33.5321,lng:133.5449},
{name:"æ˜¥é‡ä¸­å­¦æ ¡",lat:33.5289,lng:133.5440},
{name:"æ˜¥é‡æ±å°å­¦æ ¡",lat:33.5265,lng:133.5487},
{name:"ç¨®å´å…¬åœ’æ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.5108,lng:133.5451},
{name:"é•·æµœåœ°åŒºæ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.5587,lng:133.5891},
{name:"ç”²æ®¿è¥¿æ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.5387,lng:133.5692},
{name:"ä¸­å¤®å…¬åœ’",lat:33.5616,lng:133.5338},
{name:"å¼¥å³è¡›é–€å…¬åœ’",lat:33.5670,lng:133.5250},
{name:"æ¯”å³¶å…¬åœ’",lat:33.5719,lng:133.5375},
{name:"ç¦äº•å…¬åœ’",lat:33.5731,lng:133.5399},
{name:"è©å…¬åœ’",lat:33.5752,lng:133.5405}
];

function getLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lng=pos.coords.longitude;
if(userMarker) map.removeLayer(userMarker);
userMarker=L.marker([lat,lng]).addTo(map).bindPopup("ç¾åœ¨åœ°").openPopup();
map.setView([lat,lng],15);
});
}

function showShelters(){
shelterMarkers.forEach(m=>map.removeLayer(m));
shelterMarkers=[];
shelters.forEach(s=>{
let m=L.marker([s.lat,s.lng]).addTo(map).bindPopup("é¿é›£æ‰€: "+s.name);
shelterMarkers.push(m);
});
}

function routeToShelter(){
if(!userMarker){alert("ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ï¼");return;}
let u=userMarker.getLatLng();
let nearest=shelters[0],min=999;
shelters.forEach(s=>{
let d=Math.sqrt((u.lat-s.lat)**2+(u.lng-s.lng)**2);
if(d<min){min=d;nearest=s;}
});
if(routeLine) map.removeLayer(routeLine);
routeLine=L.polyline([[u.lat,u.lng],[nearest.lat,nearest.lng]]).addTo(map);
L.popup().setLatLng([nearest.lat,nearest.lng])
.setContent("æœ€å¯„ã‚Šé¿é›£æ‰€: "+nearest.name).openOn(map);
}
</script>
</body>
</html>
