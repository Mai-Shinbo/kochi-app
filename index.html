<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é«˜çŸ¥ ç½å®³æ™‚è¡Œå‹•ãƒŠãƒ“</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; font-family:sans-serif; }
#map { height:100vh; }
.panel {
  position: fixed;
  top: 10px;
  left: 10px;
  background: white;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index: 1000;
}
button {
  width: 100%;
  margin-top: 5px;
  padding: 8px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="panel">
  <b>é«˜çŸ¥ é˜²ç½è¡Œå‹•ãƒŠãƒ“</b><br>
  <button onclick="getLocation()">ğŸ“ ç¾åœ¨åœ°</button>
  <button onclick="showShelters()">ğŸ« é¿é›£æ‰€è¡¨ç¤º</button>
  <button onclick="routeToShelter()">â¡ æœ€å¯„ã‚Šé¿é›£æ‰€ã¸</button>
</div>

<div id="map"></div>

<script>
var map = L.map('map').setView([33.5588836,133.5312602],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

var userMarker;
var shelterMarkers=[];
var routeLine;

// ğŸ”¥ é¿é›£æ‰€ãƒ•ãƒ«ãƒªã‚¹ãƒˆ
var shelters=[
{name:"ç¬¬å››å°å­¦æ ¡",lat:33.5583463,lng:133.5244659},
{name:"é«˜çŸ¥å¸‚å½¹æ‰€æœ¬åºèˆ",lat:33.5584977,lng:133.5315975},
{name:"ã‹ã‚‹ã½ãƒ¼ã¨",lat:33.5583882,lng:133.5473320},
{name:"æ˜­å’Œå°å­¦æ ¡",lat:33.5601081,lng:133.5579187},
{name:"æ„›å®•ä¸­å­¦æ ¡",lat:33.5702820,lng:133.5353027},
{name:"æ±Ÿãƒå£å°å­¦æ ¡",lat:33.5688332,lng:133.5382035},
{name:"åŸè¥¿ä¸­å­¦æ ¡",lat:33.5598788,lng:133.5242010},
{name:"æ—­æ±å°å­¦æ ¡",lat:33.5594650,lng:133.5079585},
{name:"æ½®æ±Ÿæ±å°å­¦æ ¡",lat:33.5511986,lng:133.5511039},
{name:"ä¸‰é‡Œå°å­¦æ ¡",lat:33.5188704,lng:133.5830265},
{name:"äº”å°å±±ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5441215,lng:133.5834030},
{name:"æ±éƒ¨å¥åº·ç¦ç¥‰ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5553651,lng:133.5734148},
{name:"å¸ƒå¸«ç”°ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5834593,lng:133.5950810},
{name:"ä¹…é‡å°å­¦æ ¡",lat:33.6122164,lng:133.5624342},
{name:"ç§¦å°å­¦æ ¡",lat:33.5779072,lng:133.5355142},
{name:"åˆæœˆãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5743293,lng:133.5195712},
{name:"æœå€‰ä¸­å­¦æ ¡",lat:33.5442520,lng:133.4802071},
{name:"è¥¿éƒ¨å¥åº·ç¦ç¥‰ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5439438,lng:133.5033559},
{name:"é•·æµœãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5025345,lng:133.5452091},
{name:"å¾¡ç•³ç€¬ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5049447,lng:133.5560331},
{name:"æµ¦æˆ¸ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.4975264,lng:133.5669427},
{name:"é«˜çŸ¥çœŒæ•™è‚²ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5700652,lng:133.6016199},
{name:"ä»‹è‰¯ãµã‚Œã‚ã„ã‚»ãƒ³ã‚¿ãƒ¼",lat:33.5581890,lng:133.6063463},
{name:"é¡å°å­¦æ ¡",lat:33.6033758,lng:133.4723623},
{name:"åœŸä½å±±å­¦èˆ",lat:33.6338185,lng:133.5276061},
{name:"æ˜¥é‡å…¬æ°‘é¤¨å¼˜å²¡ä¸Šåˆ†é¤¨",lat:33.5044362,lng:133.4526363},
{name:"æ˜¥é‡ä¸­å­¦æ ¡",lat:33.5019197,lng:133.4898781},
{name:"æ˜¥é‡æ±å°å­¦æ ¡",lat:33.4953766,lng:133.5141407},
{name:"ç¨®å´å…¬åœ’æ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.5090914,lng:133.5724955},
{name:"é•·æµœåœ°åŒºæ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.5711719,lng:133.6920521},
{name:"ç”²æ®¿è¥¿æ´¥æ³¢é¿é›£ã‚¿ãƒ¯ãƒ¼",lat:33.4772146,lng:133.5159592},
{name:"ä¸­å¤®å…¬åœ’",lat:33.5601947,lng:133.5404874},
{name:"å¼¥å³è¡›é–€å…¬åœ’",lat:33.5734414,lng:133.5566480},
{name:"æ¯”å³¶å…¬åœ’",lat:33.5730012,lng:133.5509510},
{name:"ç¦äº•å…¬åœ’",lat:33.5730012,lng:133.5509510},
{name:"è©å…¬åœ’",lat:33.5650372,lng:133.5079780}
];

function getLocation(){
navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lng=pos.coords.longitude;
if(userMarker) map.removeLayer(userMarker);
userMarker=L.marker([lat,lng]).addTo(map).bindPopup("ç¾åœ¨åœ°").openPopup();
map.setView([lat,lng],15);
});
}

function showShelters(){
shelterMarkers.forEach(m=>map.removeLayer(m));
shelterMarkers=[];
shelters.forEach(s=>{
let m=L.marker([s.lat,s.lng]).addTo(map).bindPopup("é¿é›£æ‰€: "+s.name);
shelterMarkers.push(m);
});
}

function routeToShelter(){
if(!userMarker){alert("ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ï¼");return;}
let u=userMarker.getLatLng();
let nearest=shelters[0],min=999;
shelters.forEach(s=>{
let d=Math.sqrt((u.lat-s.lat)**2+(u.lng-s.lng)**2);
if(d<min){min=d;nearest=s;}
});
if(routeLine) map.removeLayer(routeLine);
routeLine=L.polyline([[u.lat,u.lng],[nearest.lat,nearest.lng]]).addTo(map);
L.popup().setLatLng([nearest.lat,nearest.lng])
.setContent("æœ€å¯„ã‚Šé¿é›£æ‰€: "+nearest.name).openOn(map);
}
</script>
</body>
</html>
